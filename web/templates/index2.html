<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page title</title>
    {#	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Dosis">#}
    {#    <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic" rel="stylesheet">#}
    <link rel="stylesheet" href="../static/assets/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../static/assets/fonts/awards/awards.css"/>
    <link rel="stylesheet" href="../static/assets/css/styles.css"/>
    <link rel="stylesheet" href="../static/assets/css/bootstrap-tokenfield.css"/>
    <link rel='stylesheet' href='https://sliptree.github.io/bootstrap-tokenfield/dist/css/tokenfield-typeahead.css'>
    <link rel="stylesheet" href="../static/assets/css/bootstrap.css"/>
    <link rel="icon" href="../static/assets/images/patterns/food.png">
    <link rel="stylesheet" href="https://cdn.rawgit.com/theus/chart.css/v1.0.0/dist/chart.css"/>


    <!--[if lt IE 9]>
	    <script src="../static/assets/js/html5shiv.js"></script>
	<![endif]-->
</head>
<body>
<section id="rw-layout" class="rw-layout">

    <!--
    // ===================================^__^=================================== //
       Header
    // ===================================^__^=================================== //
    -->
    <div class="rw-section rw-header">
        <div class="rw-inner clearfix">
            <div class="grid-container">

                <div class="grid desk-8 mob-6 alpha clearfix">
                    {#                    <div class="logo-holder">#}
                    {#                        <img src="../static/assets/placeholder/logo.png" class="logo" alt=""/>#}
                    {#                    </div>#}
                    <nav id="the-main-menu" class="main-menu-nav menu-inline" data-breakpoint="1160">
                        <ul class="menu horizontal">
                            <li><a href="/">Home</a></li>
                            <li>
                                <a href="recipes.html">Recipes</a>
                                <ul class="sub-menu">
                                    <li><a href="single-recipe.html">Single recipe</a></li>
                                    <li><a href="submit-recipe.html">Submit recipe</a></li>
                                </ul>
                            </li>

                            <li>
                                <a href="elem-colors.html">More</a>
                                <ul class="sub-menu">
                                    <li><a href="elem-colors.html">Colors</a></li>
                                    <li><a href="elem-buttons.html">Buttons</a></li>
                                    <li><a href="elem-typography.html">Typography</a></li>
                                    <li><a href="elem-form.html">Form</a></li>
                                    <li><a href="elem-accordion.html">Accordion</a></li>
                                    <li><a href="elem-grid.html">Grid system</a></li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>


            </div> <!-- .grid-container -->

        </div> <!-- .rw-inner -->
    </div> <!-- .rw-header -->

    <!--
    // ===================================^__^=================================== //
       Content
    // ===================================^__^=================================== //
    -->

    <div class="rw-container rw-section">
        <div class="rw-inner clearfix">


            <!-- Main content -->

            <div class="row rw-row subtle large"
                 style="border:10px solid;padding-right: 0px;padding-left: 0px;margin-right: 0px;margin-left: 0px;padding-top: 0px;padding-bottom: 0px;">

                <div class="col-2 text-light bg-dark" style="padding-top:25px">
                    {% if dname %}
                        <h4 class="text-center">{{ dname }}</h4>
                    {% else %}
                        <h4 class="text-center">{{ dname1 }}</h4>
                    {% endif %}
                </div>

                <div class="col-10" style="    padding-left: 0px;    padding-right: 0px;">
                    <div class="col-12 row"
                         style="   padding-left: 0px;    padding-right: 0px;    margin-right: 0px;    margin-left: 0px;">

                        <div class="col-2 text-light bg-dark text-center"><h4>권장식품</h4></div>
                        <div class="col-10" style="border:1px solid;padding-right: 0px;padding-left: 0px;">
                            {% if dname %}
                                {% for i in recommend %}
                                    <a class="reco" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            {% else %}
                                {% for i in recommend1 %}
                                    <a class="reco" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            {% endif %}
                        </div>

                    </div>


                    <div class="col-12 row"
                         style="    padding-left: 0px;    padding-right: 0px;    margin-right: 0px;    margin-left: 0px;">

                        <div class="col-2 text-light bg-dark text-center"><h4>주의식품</h4></div>
                        <div class="col-10" style="border:1px solid;padding-right: 0px;padding-left: 0px;">
                            {% if dname %}
                                {% for i in caution %}
                                    <a class="cau" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            {% else %}
                                {% for i in caution1 %}
                                    <a class="cau" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            {% endif %}
                        </div>

                    </div>
                </div>
            </div>

            {% if recommend2 %}

                <div class="row rw-row subtle large"
                     style="border:10px solid;padding-right: 0px;padding-left: 0px;margin-right: 0px;margin-left: 0px;padding-top: 0px;padding-bottom: 0px;">

                    <div class="col-2 text-light bg-dark" style="padding-top:25px">
                        <h4 class="text-center">{{ dname2 }}</h4>
                    </div>

                    <div class="col-10" style="    padding-left: 0px;    padding-right: 0px;">
                        <div class="col-12 row"
                             style="    padding-left: 0px;    padding-right: 0px;    margin-right: 0px;    margin-left: 0px;">

                            <div class="col-2 text-light bg-dark text-center"><h4>권장식품</h4></div>
                            <div class="col-10" style="border:1px solid;padding-right: 0px;padding-left: 0px;">
                                {% for i in recommend1 %}
                                    <a class="reco" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            </div>

                        </div>


                        <div class="col-12 row"
                             style="    padding-left: 0px;    padding-right: 0px;    margin-right: 0px;    margin-left: 0px;">

                            <div class="col-2 text-light bg-dark text-center"><h4>주의식품</h4></div>
                            <div class="col-10" style="border:1px solid;padding-right: 0px;padding-left: 0px;">
                                {% for i in caution1 %}
                                    <a class="cau" href="#" style="font-size: x-large"> {{ i +' ' }} </a>
                                {% endfor %}
                            </div>

                        </div>
                    </div>
                </div>


                {#                <div class="row rw-row subtle large " style="border:10px solid;padding-right: 0px;padding-left: 0px;">#}
                {#                    <div class="col-2 text-light bg-dark"><h4 class="text-center"#}
                {#                                                              style="margin-top:30px">{{ dname2 }}</h4></div>#}
                {#                    <div class="col-2 text-light bg-dark text-center"><h4>권장식품</h4><br><h4>주의식품</h4></div>#}
                {#                    <div class="col-8" style="border:1px solid;padding-right: 0px;padding-left: 0px;">#}
                {#                        <div style="border:1px solid">#}
                {#                            {% for i in recommend2 %}#}
                {#                                <a class="reco" href="#" style="font-size: x-large"> {{ i +' ' }} </a>#}
                {#                            {% endfor %}#}
                {#                        </div>#}
                {#                        <br>#}
                {#                        <div style="border:1px solid">#}
                {##}
                {#                            {% for i in caution2 %}#}
                {#                                <a class="cau" href="#" style="font-size: x-large"> {{ i +' ' }} </a>#}
                {#                            {% endfor %}#}
                {#                        </div>#}
                {##}
                {#                    </div>#}
                {#                </div>#}
            {% endif %}
        </div>
        <div class="row rw-row subtle large" style="   padding-bottom: 0px;">

            <div class='container'>

                <form class='form-horizontal col-12' role='form' name='find' method="POST"
                      action={{ url_for("query") }}>
                    <div class='form-group row rw-row'
                         style="margin-bottom: 0px; padding-bottom: 0px; padding-top: 0px;">
                        <h6 class="col-2">꼭 넣어야하는 식품</h6>
                        <div class='col-9'>
                            <input class='form-control input-lg js-tag-input' id='tag-input-33'
                                   placeholder='꼭 넣을 식품' type='text' name="insert">
                        </div>
                        <div class='col-1'>
                            <submit class='btn btn-primary btn-lg btn-block' style="display: none" type='submit'>
                                검색
                            </submit>
                        </div>
                    </div>
                    <div class="'form-group row rw-row"
                         style="margin-bottom: 0px; padding-bottom: 0px; padding-top: 0px;">
                        <h6 class="col-2">꼭 빼야하는 식품</h6>
                        <div class='col-9'>
                            <input class='form-control input-lg js-tag-input' id='tag-input'
                                   placeholder='꼭 뺄 식품' type='text' name="remove">
                        </div>
                        <div class='col-1'>
                            <submit class='btn btn-primary btn-md btn-block' type='submit'>
                                Send
                            </submit>
                        </div>
                    </div>


                </form>

            </div>
            <div class="row rw-row subtle large" style="    padding-bottom: 0px;    padding-top: 0px;">

                <form name="myForm" method="POST" action="{{ url_for('query') }}">
                    <div class="form-group">
                        <input type="text" class="hidden" style="display: none" name="order" value="recommend"/>
                        <button class="btn-primary" id="recommend" type="submit">권장률순</button>
                    </div>
                </form>
                <form name="myForm" method="POST" action="{{ url_for('query') }}">
                    <div class="form-group">
                        <input type="text" class="hidden" style="display: none" name="order" value="caution"/>
                        <button class="btn-primary" id="caution" type="submit">위험률순</button>
                    </div>
                </form>
                <form name="myForm" method="POST" action="{{ url_for('query') }}">
                    <div class="form-group">
                        <input type="text" class="hidden" style="display: none" name="order" value="rc"/>
                        <button class="btn-primary" id="rc" type="submit">추천지수순</button>
                    </div>
                </form>

            </div>

        </div>

        <div class="rw-column rw-content">

            <div class="rw-row subtle large border-tb" style="text-align: center">

                <div class="grid-container carousel-container">

                    <div class="grid desk-6 mob-6">
                        <h4 class="carousel-posts-heading">추천 레시피</h4>
                    </div>

                    <div class="clear"></div>

                    <!-- 메뉴 TODO 메뉴-->
                    {% set src = ["../static/assets/placeholder/food/350x240/18.jpg", "../static/assets/placeholder/food/350x240/1.jpg", "../static/assets/placeholder/food/350x240/4.jpg", "../static/assets/placeholder/food/350x240/5.jpg", "../static/assets/placeholder/food/350x240/9.jpg"] %}
                    <!-- TODO 메뉴 목록 만들기 참조 (1페이지에 20개, 각 행에 4개씩 5행)-->
                    <!-- 한행에 다 보여주려면 맨 바깥 for는 필요 없음 -->

                    <!-- "&{aaa};" -->

                    {% for i in range(5) %}
                        {#                            <h1>{{ pageNum }}</h1>#}
                        <div class="home-carousel-posts clearfix"> <!-- 한 행을 구성하는 div 클래스 -->
                            <!-- loop.index는 현제 루프가 몇번째인지 알려줌 1,2,.... -->

                            <!-- 1 | int 는 1을 int로 취급하게 함. (경우에 따라 안하면 문자열로 인식함) -->

                            <!-- data는 계산된 지수들을 가지고 있는 딕셔너리,
                                 rate는 계산된 지수를 오름/내림 차순 정렬한 음식명 리스트 || 특정 음식만 검색한 결과에 대한 오름/내림 차순
                                 menu는 음식명 -->
                            <!-- (((page-1)*5)+(index-1)) * 4: (((page-1)*5)+(index)) * 4  -->
                            {#                             <h1>start {{ (((pageNum|int-(1|int))*5)+((loop.index | int)-(1|int))) * 4 }}</h1>#}
                            {#                                <h1>end {{ (((pageNum|int-(1|int))*5)+((loop.index | int))) * 4 }}</h1>#}
                            {% for menu in rate[  (((pageNum|int-(1|int))*5)+((loop.index | int)-(1|int))) * 4 : (((pageNum|int-(1|int))*5)+((loop.index | int))) * 4] %}

                                <!-- Entry 한행에 들어갈 메뉴들 개수에 따라서 4개를 초과하면 좌우 스크롤이 가능 -->
                                <div class="entry style-columns">
                                    <div class="entry-photo"> <!-- 사진 -->
                                        {#                                            <img src={{ src[i] }} alt=""/>#}
                                        {% for j in recipe %}
                                            {% if j['food_name'] == menu %}
                                                {#                                                    <h1>{{ j['img'] | length }}</h1>#}
                                                <img src="{{ j['img'] }}" style="width:240px; height:180px;"
                                                     alt=""/>
                                            {% endif %}
                                        {% endfor %}
                                    </div>

                                    <div class="entry-title" style="height:3.6em; overflow : hidden"> <!-- 메뉴 제목 -->
                                        <a name='menu' href='recipe?value={{ menu }}'>{{ menu }}</a>
                                    </div>

                                    {#                                        <div class="entry-content"> <!-- 세부 내용 -->#}
                                    {#                                            {{ menu }}#}
                                    {#                                            {{ data[menu] }}#}
                                    {#                                            <br>#}
                                    {#                                            <div class="p-3 mb-2 bg-success text-white">{{ (data[menu]['권장률'] * 100 ),"%" }}</div>#}
                                    {#                                            <div class="p-3 mb-2 bg-danger text-white">{{ (data[menu]['위험률'] * 100),"%" }}</div>#}
                                    {#                                            <div class="p-3 mb-2 bg-primary text-white">{{ (data[menu]['추천지수'] * 100 ), "%" }}</div>#}

                                    {#                                        </div>#}


                                    <div class="entry-content"> <!-- 세부 내용 -->
                                        {#                                            {{ menu }}#}
                                        {#                                            {{ data[menu] }}#}
                                        {#                                            <br>#}
                                        <div class="row" style="margin-right: 5px">


                                            <div class="col-12 charts">

                                                {% if ((data[menu]['권장률'] * 100) |int)  < 40 %}
                                                    <div class="row" style="margin-left: 0px;"><p
                                                            style="margin-top: 5px;margin-bottom: 0px;">권장률</p>
                                                        <div class="charts__chart chart--p{{((data[menu]['권장률'] * 100) |int)}} chart--sm"
                                                             data-percent=""></div><!-- /.charts__chart -->
                                                    </div>

                                                {% else %}
                                                    <div class="charts__chart chart--green" style="width : {{ (data[menu]['권장률'] * 100) |int }}%">
                                                        <span style="color:#ebeded; font-size:1.2em">권장률 {{ (data[menu]['권장률'] * 100) |int }}%</span>
                                                    </div>
                                                {% endif %}
                                                <!-- /.charts__chart -->

                                                {% if ((data[menu]['위험률'] * 100) |int)  == 0 %}
                                                    <div class="row" style="margin-left: 0px;"><p
                                                            style="margin-top: 5px;margin-bottom: 0px;">위험률</p>
                                                        <div class="charts__chart chart--p{{ ((data[menu]['위험률'] * 100) |int) }} chart--sm"
                                                             data-percent=""></div><!-- /.charts__chart -->
                                                    </div>
                                                {% elif ((data[menu]['위험률'] * 100) |int)  <= 20 %}
                                                    <div class="charts__chart chart--red"
                                                         style="width: {{ (data[menu]['위험률'] * 100) |int }}%"></div>
                                                {% else %}
                                                    <div class="charts__chart chart--red"
                                                         style="width: {{ (data[menu]['위험률'] * 100) |int }}%">
                                                        <span style="color:#ebeded; font-size:1.2em">위험률 {{ (data[menu]['위험률'] * 100) |int }}%</span>
                                                    </div>
                                                    <!-- /.charts__chart -->
                                                {% endif %}


                                                {% if ((data[menu]['추천지수'] * 100) |int)  == 0 %}
                                                    <div class="row" style="margin-left: 0px;"><p
                                                            style="margin-top: 5px;margin-bottom: 0px;">추천지수</p>
                                                        <div class="charts__chart chart--p0 chart--sm"
                                                             data-percent=""></div><!-- /.charts__chart -->
                                                    </div>

                                                {% else %}

                                                    <div class="charts__chart chart--blue"
                                                         style="width: {{ (data[menu]['추천지수'] * 100) |int }}%">
                                                        <span style="color:#ebeded; font-size:1.2em">추천지수 {{ (data[menu]['추천지수'] * 100) |int }}%</span>


                                                    </div>
                                                {% endif %}

                                                <!-- /.charts__chart -->
                                            </div><!-- /.charts -->
                                        </div>

                                    </div>

                                    {#                                    <div class="row entry-content" style="margin-right: 5px">#}
                                    {#                                        <div class="col-4 mb-2 bg-success text-white">권장률#}
                                    {#                                            ({{ '%0.2f' % (data[menu]['권장률'] * 100) |float }}%)#}
                                    {#                                        </div>#}
                                    {#                                        <div class="col-4  mb-2 bg-danger text-white">위험률#}
                                    {#                                            ({{ '%0.2f' % (data[menu]['위험률'] * 100) |float }}%)#}
                                    {#                                        </div>#}
                                    {#                                        <div class="col-4  mb-2 bg-primary text-white" style="font-size: 14px">#}
                                    {#                                            추천지수 ({{ '%0.2f' % (data[menu]['추천지수'] * 100) |float }}%)#}
                                    {#                                        </div>#}
                                    {#                                    </div>#}


                                    {#                                        <div class="entry-controls">#}
                                    {#                                            <a href="#" class="control entry-to-favorites" title="Add to favorites">#}
                                    {#                                                <i#}
                                    {#                                                        class="fa fa-heart-o"></i> </a><span#}
                                    {#                                                class="control-tip">24</span>#}
                                    {#                                            <a href="#" class="control entry-like" title="I like this!"> <i#}
                                    {#                                                    class="fa fa-thumbs-o-up"></i> </a> <span#}
                                    {#                                                class="control-tip">115</span>#}
                                    {#                                        </div>#}
                                </div> <!-- .entry -->

                            {% endfor %}
                        </div> <!-- .home-carousel-posts -->
                    {% endfor %}


                </div>
                <div class="text-center" style="display: inline-block">
                    <nav aria-label="Page navigation">
                        <ul class="pagination" id="pagination"></ul>
                    </nav>
                </div>

            </div>
        </div> <!-- .rw-row -->

    </div>

    </div> <!-- .rw-inner -->
    </div> <!-- .rw-container -->

    <!--
    // ===================================^__^=================================== //
       Footer
    // ===================================^__^=================================== //
    -->
    <div class="rw-section rw-footer">
        <div class="rw-inner clearfix">
            <a href="#rw-layout" class="footer-to-top" title="Go to top">
                <i class="fa fa-chevron-up"></i>
            </a>
        </div>
    </div> <!-- .layout-footer -->

</section><!-- .rw-layout -->

<!-- Javascript -->
{#<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>#}
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script src="../static/assets/js/min/smk-menu.min.js"></script>
<script src="../static/assets/js/rw-sidebar.js"></script>
<script src="../static/assets/js/min/jquery.qtip.min.js"></script>
<script src="../static/assets/js/min/smk-accordion.min.js"></script>
<script src="../static/assets/js/min/smk-visual-select.min.js"></script>
<script src="../static/assets/js/min/owl.carousel.min.js"></script>
<script src="../static/assets/js/scripts.js"></script>

<script src="../static/assets/js/bootstrap-paginator.js"></script>
<script src="../static/assets/js/bootstrap.min.js" type="text/javascript"></script>
<script src='https://sliptree.github.io/bootstrap-tokenfield/docs-assets/js/typeahead.bundle.min.js'></script>
<script type="text/javascript" src='../static/assets/js/bootstrap-tokenfield.js'></script>

<script src="../static/assets/js/index.js"></script>
<script src="../static/assets/js/twbsPagination.js" type="text/javascript"></script>
<script src="../static/assets/js/jquery.cookie.js"></script>

<script type="text/javascript">

    function addValue() {
        if (window.name != "") {
            if (window.document.getElementById("tag-input-33") != null)
                window.document.getElementById("tag-input-33").value = window.name;
            console.log("not null");
        }
        // console.log("onload1" + window.document.getElementById("tag-input-33").value);
        // console.log("onload2" + window.document.getElementsByClassName("close").value);
        // console.log("onload2" + window.document.getElementsByClassName("close"));
    }


    // 페이지 로드시
    window.onload = addValue();

    function recoClick() {
        console.log(this.text);

        $('#tag-input-33').tokenfield('createToken', this.text)
        $('#tag-input-33').on('tokenfield:createtoken', function (event) {
            var existingTokens = $(this).tokenfield('getTokens');
            $.each(existingTokens, function (index, token) {
                if (token.value === event.attrs.value)
                    event.preventDefault();
            });
        });
        console.log("value3" + window.document.getElementById("tag-input-33").value);
    }

    var recos = document.getElementsByClassName("reco");
    for (var i = 0; i < recos.length; i++) {
        var reco = recos.item(i);
        reco.addEventListener("click", recoClick);
    }

    function cauClick() {
        console.log(this.text);
        $('#tag-input').tokenfield();
        $('#tag-input').tokenfield('createToken', this.text);

        $('#tag-input').on('tokenfield:createtoken', function (event) {
            var existingTokens = $(this).tokenfield('getTokens');
            $.each(existingTokens, function (index, token) {
                if (token.value === event.attrs.value)
                    event.preventDefault();
            });
        });

        console.log("value3" + window.document.getElementById("tag-input-33").value);
    }

    var caus = document.getElementsByClassName("cau");
    for (i = 0; i < caus.length; i++) {
        var cau = caus.item(i);
        cau.addEventListener("click", cauClick);
    }
</script>

<script type="text/javascript">
    var gpage;

    gpage = $.cookie('page');
    console.log('page cookie : ' + gpage);


    if (gpage == undefined) {
        gpage = 1;
    }
    console.log('page : ' + gpage);


    var form;


    $(function () {
        if (window.pagObj == undefined) {

            var total = {{ (((rate|length)|int)/20)|int }};

            if (parseInt(gpage) > parseInt(total))
                total = gpage;


            window.pagObj = $('#pagination').twbsPagination({
                totalPages: parseInt(total),
                visiblePages: 10,
                startPage: parseInt(gpage),
                onPageClick: function (event, page) {
                    console.info(page + ' (from options)');
                    console.log('page in : ' + gpage);

                    $.cookie('page', page);

                    if (gpage != undefined)
                        gpage = $.cookie('page');
                    page = gpage;
                    {#if(page.toString() != "1"){#}
                    // form
                    console.log('page after : ' + gpage);

                    form = document.createElement("form");
                    form.setAttribute("method", "post");
                    form.setAttribute("action", "{{ url_for('query') }}");

                    document.body.appendChild(form);


                    //input
                    var input_id = document.createElement("input");

                    input_id.setAttribute("type", "hidden");
                    input_id.setAttribute("name", "pageNum");
                    input_id.setAttribute("value", page);

                    form.appendChild(input_id);


                }
            }).on('page', function (event, page) {
                form.submit();                    //폼전송

                console.info(page + ' (from event listening)');
            });
        }

    });
</script>

</body>
</html>